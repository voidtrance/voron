[gcode_macro _TOOLHEAD_LED_VARS]
variable_leds_name: "toolhead_leds"
variable_nozzle_leds: "1,3"
variable_logo_leds: "2"
variable_colors: {
        "off":      { "logo": [0, 0, 0, 0], "nozzle": [0, 0, 0, 0]},
        "idle":     { "logo": [0, 0, 1, 0], "nozzle": [0, 0, 0, 0]},
        "printing": { "logo": [0, 1, 0, 0], "nozzle": [0, 0, 0, 1]},
        "paused":   { "logo": [1, 0, 1, 0], "nozzle": [0, 0, 0, 1]},
        "error":    { "logo": [1, 0, 0, 0], "nozzle": [1, 0, 0, 0]},
    }
gcode:

[gcode_macro SET_TOOLHEAD_LED]
gcode:
    {% set red = params.RED|float %}
    {% set green = params.GREEN|float %}
    {% set blue = params.BLUE|float %}
    {% set white = params.WHITE|float %}
    {% set items = params.LEDS|default("all")|string %}
    {% set transmit = params.TRANSMIT|default(1)|int %}

    {% set vars = printer["gcode_macro _TOOLHEAD_LED_VARS"] %}
    {% set items = "nozzle,logo" if items == "all" else items %}
    {% set items = items.split(",") %}

    {% for item in items %}
        {% set leds = vars[item + "_leds"].split(",") %}
        {% set do_transmit = transmit if loop.last else 0 %}
        {% for led in leds %}
            SET_LED LED={vars.leds_name} INDEX={led} RED={red} GREEN={green} BLUE={blue} WHITE={white} TRANSMIT={do_transmit}
        {% endfor %}
    {% endfor %}

[gcode_macro _SET_TOOLHEAD_LED_STATE]
gcode:
    {% set state = params.STATE %}
    {% set led = params.LED %}
    {% set transmit = params.TRANSMIT|default(1)|int %}
    {% set colors = printer["gcode_macro _TOOLHEAD_LED_VARS"]["colors"][state][led] %}

    {action_respond_info("state=%s -> %s=%s" % (state,led,colors))}
    SET_TOOLHEAD_LED LEDS={led} RED={colors[0]} GREEN={colors[1]} BLUE={colors[2]} WHITE={colors[3]} TRANSMIT={transmit}

    
[gcode_macro SET_TOOLHEAD_STATE]
gcode:
    {% set state = params.STATE|default("idel")|string %}
    {% set vars = printer["gcode_macro _TOOLHEAD_LED_VARS"] %}

    {% if state not in vars.colors %}
      {action_respond_info("Toolhead LED state '%s' not found" % state)}
    {% else %}
      _SET_TOOLHEAD_LED_STATE LED=logo STATE={state} TRANSMIT=0
      _SET_TOOLHEAD_LED_STATE LED=nozzle STATE={state}
    {% endif %}