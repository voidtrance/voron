[gcode_macro CLEAR_BED]
description: Move toolhead away from bed
gcode:
    {% set user_vars = printer["gcode_macro USER_VARIABLES"] %}

    SAVE_GCODE_STATE NAME=clear_bed
    G90
    G0 X{user_vars.macros.park_position.bed_clear.x} Y{user_vars.macros.park_position.bed_clear.y} Z{user_vars.macros.park_position.bed_clear.z} F3600
    RESTORE_GCODE_STATE NAME=clear_bed

[gcode_macro M300]
description: Play tone
gcode:  
    {% set S = params.S|default(1000)|int %} ; S sets the tone frequency
    {% set P = params.P|default(100)|int %} ; P sets the tone duration
    {% set L = 0.5 %} ; L varies the PWM on time, close to 0 or 1 the tone gets a bit quieter. 0.5 is a symmetric waveform
    {% if S <= 0 %} ; dont divide through zero
      {% set F = 1 %}
      {% set L = 0 %}
    {% elif S >= 10000 %} ;max frequency set to 10kHz
      {% set F = 0 %}
    {% else %}
      {% set F = 1/S|float %} ;convert frequency to seconds 
    {% endif %}
    SET_PIN PIN=beeper VALUE={L} CYCLE_TIME={F} ;Play tone
    G4 P{P} ;tone duration
    SET_PIN PIN=beeper VALUE=0

[gcode_macro BEEP]
gcode:
  {% set count = params.COUNT|default(1)|int %}

  {% for i in range(count) %}
    M300
    G4 P50
  {% endfor %}

[delayed_gcode __CLEAR_DISP]
gcode:
    M117

[gcode_macro CLEAR_DISP]
description: Clear display with optional timeout.
gcode:
    {% set delay = params.TIMEOUT|default(0)|int %}

    {% if delay == 0 %}
      M117
    {% else %}
      UPDATE_DELAYED_GCODE ID=__CLEAR_DISP DURATION={delay}
    {% endif %}
